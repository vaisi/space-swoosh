(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class M{constructor(t){console.log("Creating spacecraft..."),this.game=t,this.radius=t.config.spacecraft.radius*t.baseUnit,this.x=t.canvas.width/2,this.y=t.canvas.height*.85,this.baseSpeed=t.config.spacecraft.speed*t.canvas.height,this.arcRadius=t.config.spacecraft.arcRadius*t.canvas.width,this.arcDuration=t.config.spacecraft.arcDuration,this.trail=[],this.moveState=null,this.verticalSpeed=this.baseSpeed,this.isVisible=!0,this.verticalVelocity=this.baseSpeed,this.shieldActive=!1,this.shieldTimer=0,this.shieldDuration=5e3,this.shieldPulse=0,this.shieldWarningStarted=!1,console.log("Spacecraft position:",this.x,this.y)}reset(){this.x=this.game.canvas.width/2,this.y=this.game.canvas.height*.85,this.trail=[],this.moveState=null,this.isVisible=!0}update(){const t=performance.now(),e=this.baseSpeed;if(this.verticalVelocity=this.verticalVelocity*.95+e*.05,this.y-=this.verticalVelocity*(1/60),this.moveState){const s=t-this.moveState.startTime,i=Math.min(1,s/this.arcDuration),a=(this.moveState.direction==="left"?-1:1)*Math.PI*i,h=this.moveState.startX+Math.sin(a)*this.arcRadius;if(h<this.radius||h>this.game.canvas.width-this.radius){const c=h<this.radius?"right":"left",r=h<this.radius?this.radius:this.game.canvas.width-this.radius;this.moveState={startX:r,startY:this.y,startTime:t,direction:c},this.x=r}else this.x=h;const n=Math.sin(i*Math.PI)*(this.baseSpeed*.3);this.verticalVelocity=this.baseSpeed+n,i>=1&&(this.moveState=null)}this.updateTrail(),this.shieldActive&&(this.shieldTimer-=1e3/60,this.shieldPulse+=.1,this.shieldTimer<1500&&!this.shieldWarningStarted&&(this.shieldWarningStarted=!0,this.shieldPulse=0),this.shieldTimer<=0&&(this.shieldActive=!1,this.shieldWarningStarted=!1))}startMovement(t){this.moveState={startX:this.x,startY:this.y,startTime:performance.now(),direction:t}}updateTrail(){const t=this.trail[this.trail.length-1];(!t||Math.hypot(this.x-t.x,this.y-t.y)>this.game.config.spacecraft.trailSpacing)&&this.trail.push({x:this.x,y:this.y,opacity:1}),this.trail=this.trail.map(e=>({...e,opacity:e.opacity-1/180})).filter(e=>e.opacity>0).slice(-50)}render(t){t.beginPath(),t.arc(this.x,this.game.camera.getRelativeY(this.y),this.radius,0,Math.PI*2),t.fillStyle="#000000",t.fill();const e=this.radius*this.game.config.spacecraft.trailDotSize;if(this.trail.forEach(s=>{t.beginPath(),t.arc(s.x,this.game.camera.getRelativeY(s.y),e,0,Math.PI*2),t.fillStyle=`rgba(0, 0, 0, ${s.opacity})`,t.fill()}),this.shieldActive){let s,i;this.shieldWarningStarted?(s=1+Math.sin(this.shieldPulse*2)*.3,i=.7+Math.sin(this.shieldPulse*2)*.3):(s=1+Math.sin(this.shieldPulse)*.2,i=.5+Math.sin(this.shieldPulse)*.2);const a=this.radius*1.5*s;t.beginPath(),t.arc(this.x,this.game.camera.getRelativeY(this.y),a,0,Math.PI*2),t.strokeStyle=`rgba(0, 0, 0, ${i})`,t.lineWidth=this.radius*.2,t.stroke(),t.beginPath(),t.arc(this.x,this.game.camera.getRelativeY(this.y),a*1.1,0,Math.PI*2),t.strokeStyle=`rgba(0, 0, 0, ${i*.5})`,t.lineWidth=this.radius*.1,t.stroke()}}activateShield(){this.shieldActive=!0,this.shieldTimer=this.shieldDuration,this.shieldWarningStarted=!1,this.shieldPulse=0}}class y{constructor(t,e,s,i){this.game=t,this.x=e,this.y=s,this.size=i,this.rotation=0,this.rotationSpeed=Math.random()*(t.config.obstacles.rotationRange[1]-t.config.obstacles.rotationRange[0])+t.config.obstacles.rotationRange[0]}update(){this.rotation+=this.rotationSpeed}checkCollision(t){const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)<this.size+t.radius}createDestructionParticles(){const t=[],s=this.game.baseUnit*.5;for(let i=0;i<10;i++){const a=Math.PI*2*i/10,h=s*(2+Math.random()*3);t.push({x:this.x,y:this.y,vx:Math.cos(a)*h,vy:Math.sin(a)*h,size:this.size*(.1+Math.random()*.2),opacity:1,rotation:Math.random()*Math.PI*2})}return t}}class P extends y{constructor(t,e,s,i){super(t,e,s,i),this.shapeType=["circle","triangle","square"][Math.floor(Math.random()*3)]}render(t){const e=this.game.camera.getRelativeY(this.y);if(!(e+this.size<0||e-this.size>this.game.canvas.height)){switch(t.save(),t.translate(this.x,e),t.rotate(this.rotation),t.beginPath(),this.shapeType){case"circle":t.arc(0,0,this.size,0,Math.PI*2);break;case"triangle":t.moveTo(0,-this.size),t.lineTo(this.size*Math.cos(Math.PI/6),this.size*Math.sin(Math.PI/6)),t.lineTo(-this.size*Math.cos(Math.PI/6),this.size*Math.sin(Math.PI/6));break;case"square":const s=this.size*.7;t.rect(-s,-s,s*2,s*2);break}t.closePath(),t.fillStyle="#000000",t.fill(),t.restore()}}checkCollision(t){const e=t.x-this.x,s=t.y-this.y;if(Math.sqrt(e*e+s*s)>this.size+t.radius)return!1;if(this.shapeType==="circle")return!0;const a=Math.cos(-this.rotation),h=Math.sin(-this.rotation),n=e*a-s*h,c=e*h+s*a;if(this.shapeType==="square"){const r=this.size*.7;return Math.abs(n)<=r+t.radius&&Math.abs(c)<=r+t.radius}else{const r=[{x:0,y:-this.size},{x:this.size*Math.cos(Math.PI/6),y:this.size*Math.sin(Math.PI/6)},{x:-this.size*Math.cos(Math.PI/6),y:this.size*Math.sin(Math.PI/6)}];return x(n,c,r[0],r[1],r[2],t.radius)}}}function x(o,t,e,s,i,a){const h=v(o,t,e.x,e.y,s.x,s.y),n=v(o,t,s.x,s.y,i.x,i.y),c=v(o,t,i.x,i.y,e.x,e.y);if(h<=a||n<=a||c<=a)return!0;let r=S(o,t,e.x,e.y,s.x,s.y),m=S(o,t,s.x,s.y,i.x,i.y),d=S(o,t,i.x,i.y,e.x,e.y),l=r<0||m<0||d<0,g=r>0||m>0||d>0;return!(l&&g)}function S(o,t,e,s,i,a){return(o-i)*(s-a)-(e-i)*(t-a)}function v(o,t,e,s,i,a){const h=o-e,n=t-s,c=i-e,r=a-s,m=h*c+n*r,d=c*c+r*r;let l=-1;d!==0&&(l=m/d);let g,u;l<0?(g=e,u=s):l>1?(g=i,u=a):(g=e+l*c,u=s+l*r);const p=o-g,f=t-u;return Math.sqrt(p*p+f*f)}class z extends y{constructor(t,e){const s=t.canvas.width*.7,i=t.baseUnit*3;super(t,t.canvas.width/2,e,Math.max(s,i)/2),this.width=s,this.height=i}render(t){const e=this.game.camera.getRelativeY(this.y);e+this.height<0||e-this.height>this.game.canvas.height||(t.save(),t.translate(this.x,e),t.rotate(this.rotation),t.beginPath(),t.ellipse(0,0,this.width/2,this.height/2,0,0,Math.PI*2),t.fillStyle="#000000",t.fill(),t.restore())}checkCollision(t){const e=t.x-this.x,s=this.game.camera.getRelativeY(t.y)-this.game.camera.getRelativeY(this.y),i=Math.cos(-this.rotation),a=Math.sin(-this.rotation),h=e*i-s*a,n=e*a+s*i;return Math.pow(h,2)/Math.pow(this.width/2,2)+Math.pow(n,2)/Math.pow(this.height/2,2)<=1}}class T extends y{constructor(t,e,s,i){super(t,e,s,i),this.satellites=[];const a=2+Math.floor(Math.random()*3),h=.02+Math.random()*.02;for(let n=0;n<a;n++)this.satellites.push({angle:Math.PI*2*n/a,distance:i*2,size:i*.3,speed:h})}update(){super.update(),this.satellites.forEach(t=>{t.angle+=t.speed})}render(t){const e=this.game.camera.getRelativeY(this.y);e+this.size<0||e-this.size>this.game.canvas.height||(t.save(),t.translate(this.x,e),t.rotate(this.rotation),t.beginPath(),t.moveTo(0,-this.size),t.lineTo(this.size,0),t.lineTo(0,this.size),t.lineTo(-this.size,0),t.closePath(),t.fillStyle="#000000",t.fill(),this.satellites.forEach(s=>{const i=Math.cos(s.angle)*s.distance,a=Math.sin(s.angle)*s.distance;t.beginPath(),t.arc(i,a,s.size,0,Math.PI*2),t.fill()}),t.restore())}checkCollision(t){const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)<this.size+t.radius?!0:this.satellites.some(a=>{const h=this.x+Math.cos(a.angle)*a.distance,n=this.y+Math.sin(a.angle)*a.distance,c=h-t.x,r=n-t.y;return Math.sqrt(c*c+r*r)<a.size+t.radius})}}class A extends y{constructor(t,e,s,i){super(t,e,s,i),this.baseSize=i,this.growthRate=.5,this.maxSize=i*2,this.currentSize=i}update(){super.update(),this.currentSize+=this.growthRate*(1/60),this.currentSize>this.maxSize&&(this.currentSize=this.baseSize)}render(t){const e=this.game.camera.getRelativeY(this.y);e+this.currentSize<0||e-this.currentSize>this.game.canvas.height||(t.save(),t.translate(this.x,e),t.rotate(this.rotation),t.beginPath(),t.arc(0,0,this.currentSize,0,Math.PI*2),t.fillStyle="#000000",t.fill(),t.restore())}checkCollision(t){const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)<this.currentSize+t.radius}}class C extends y{constructor(t,e,s,i){super(t,e,s,i),this.speed=t.baseUnit*2,this.direction=Math.random()<.5?-1:1,this.originalX=e,this.amplitude=t.canvas.width*.3}update(){super.update(),this.x+=this.speed*this.direction*(1/60),Math.abs(this.x-this.originalX)>this.amplitude&&(this.direction*=-1)}render(t){const e=this.game.camera.getRelativeY(this.y);if(!(e+this.size<0||e-this.size>this.game.canvas.height)){t.save(),t.translate(this.x,e),t.rotate(this.rotation),t.beginPath();for(let s=0;s<5;s++){const i=s*2*Math.PI/5-Math.PI/2,a=this.size*Math.cos(i),h=this.size*Math.sin(i);s===0?t.moveTo(a,h):t.lineTo(a,h)}t.closePath(),t.fillStyle="#000000",t.fill(),t.restore()}}checkCollision(t){const e=t.x-this.x,s=t.y-this.y,i=Math.cos(-this.rotation),a=Math.sin(-this.rotation),h=e*i-s*a,n=e*a+s*i,c=this.size,r=Math.atan2(n,h),m=2*Math.PI/5,d=Math.floor((r+Math.PI)/m),l=(d+1)%5,g=c*Math.cos(d*m),u=c*Math.sin(d*m),p=c*Math.cos(l*m),f=c*Math.sin(l*m);return U(h,n,g,u,p,f)<t.radius}}function U(o,t,e,s,i,a){const h=o-e,n=t-s,c=i-e,r=a-s,m=h*c+n*r,d=c*c+r*r;let l=-1;d!==0&&(l=m/d);let g,u;l<0?(g=e,u=s):l>1?(g=i,u=a):(g=e+l*c,u=s+l*r);const p=o-g,f=t-u;return Math.sqrt(p*p+f*f)}class I extends y{constructor(t,e,s,i){super(t,e,s,i),this.projectiles=[],this.shootInterval=2e3,this.lastShootTime=performance.now(),this.projectileSpeed=t.baseUnit*3,this.projectileSize=i*.2}update(){super.update();const t=performance.now();if(t-this.lastShootTime>this.shootInterval){const e=Math.random()*Math.PI*2;this.projectiles.push({x:this.x,y:this.y,vx:Math.cos(e)*this.projectileSpeed,vy:Math.sin(e)*this.projectileSpeed}),this.lastShootTime=t}this.projectiles=this.projectiles.map(e=>({...e,x:e.x+e.vx*(1/60),y:e.y+e.vy*(1/60)})).filter(e=>{const s=this.game.camera.getRelativeY(e.y);return s>-this.size&&s<this.game.canvas.height+this.size})}render(t){const e=this.game.camera.getRelativeY(this.y);if(!(e+this.size<0||e-this.size>this.game.canvas.height)){t.save(),t.translate(this.x,e),t.rotate(this.rotation),t.beginPath();for(let s=0;s<8;s++){const i=s%2===0?this.size:this.size*.5,a=s*Math.PI/4,h=i*Math.cos(a),n=i*Math.sin(a);s===0?t.moveTo(h,n):t.lineTo(h,n)}t.closePath(),t.fillStyle="#000000",t.fill(),t.restore(),this.projectiles.forEach(s=>{t.beginPath(),t.arc(s.x,this.game.camera.getRelativeY(s.y),this.projectileSize,0,Math.PI*2),t.fillStyle="#000000",t.fill()})}}checkCollision(t){return super.checkCollision(t)?!0:this.projectiles.some(e=>{const s=e.x-t.x,i=e.y-t.y;return Math.sqrt(s*s+i*i)<this.projectileSize+t.radius})}}class Y extends y{constructor(t,e){const s=t.baseUnit*1.2,i=Math.random()<.5,a=i?-s:t.canvas.width+s;super(t,a,e,s),this.speed=t.baseUnit*15,this.direction=i?1:-1,this.trailParticles=[]}update(){return super.update(),this.x+=this.speed*this.direction*(1/60),this.trailParticles.push({x:this.x,y:this.y,size:this.size*.5,opacity:1}),this.trailParticles=this.trailParticles.map(t=>({...t,opacity:t.opacity-.05,size:t.size*.95})).filter(t=>t.opacity>0),this.isOffScreen()}isOffScreen(){return this.direction>0&&this.x>this.game.canvas.width+this.size*2||this.direction<0&&this.x<-this.size*2}render(t){const e=this.game.camera.getRelativeY(this.y);this.trailParticles.forEach(s=>{t.beginPath(),t.arc(s.x,this.game.camera.getRelativeY(this.y),s.size,0,Math.PI*2),t.fillStyle=`rgba(0, 0, 0, ${s.opacity})`,t.fill()}),t.save(),t.translate(this.x,e),t.beginPath(),t.arc(0,0,this.size,0,Math.PI*2),t.fillStyle="#000000",t.fill(),t.restore()}}class w{constructor(t){var s;this.game=t,this.obstacles=[],this.nextSpawnY=0;const e={simple:{weight:1,unlockScore:0},belt:{weight:1,unlockScore:200},complex:{weight:1,unlockScore:300},pulsating:{weight:1,unlockScore:400},moving:{weight:1,unlockScore:500},shooting:{weight:1,unlockScore:600},comet:{weight:.3,unlockScore:700}};this.obstacleTypes=((s=this.game.config.obstacles)==null?void 0:s.types)||e,this.availableTypes=new Set(["simple"]),this.tutorialPhase=!0,this.tutorialMessages=[{distance:25,message:"Use LEFT and RIGHT arrows to move in arcs",requirement:()=>this.hasPlayerMoved(),completed:!1},{distance:75,message:"Breaking the atmosphere!",requirement:()=>!0,completed:!1,triggerCutscene:!0}],this.movementHistory={left:!1,right:!1},this.destructionParticles=[],this.lastCometTime=0,this.cometInterval=9e3+Math.random()*14e3,this.inCutscene=!1,this.cutsceneStartTime=0,this.cutsceneDuration=1500,this.motionLines=[]}hasPlayerMoved(){return this.movementHistory.left||this.movementHistory.right}trackMovement(t){this.movementHistory[t]=!0}update(){const t=Math.abs(this.game.camera.totalDistance);if(t<75){this.game.spacecraft.moveState&&this.trackMovement(this.game.spacecraft.moveState.direction);for(let s=0;s<this.tutorialMessages.length;s++){const i=this.tutorialMessages[s];!i.completed&&t>=i.distance&&(s===0||this.tutorialMessages[s-1].completed)&&(i.requirement()?(i.completed=!0,i.triggerCutscene?(this.inCutscene=!0,this.cutsceneStartTime=performance.now(),this.game.camera.speed*=3,this.createMotionLines()):s<this.tutorialMessages.length-1&&setTimeout(()=>{this.showTutorialMessage(this.tutorialMessages[s+1].message)},1500)):this.currentMessage||this.showTutorialMessage(i.message))}if(this.inCutscene){const s=(performance.now()-this.cutsceneStartTime)/this.cutsceneDuration,i=Math.sin(s*Math.PI)*5;this.game.camera.shake={x:(Math.random()-.5)*i,y:(Math.random()-.5)*i},this.updateMotionLines()}if(this.inCutscene&&performance.now()-this.cutsceneStartTime>this.cutsceneDuration&&(this.inCutscene=!1,this.game.camera.speed/=3,this.game.camera.shake={x:0,y:0},this.motionLines=[],this.tutorialPhase=!1,this.nextSpawnY=this.game.camera.y-this.game.canvas.height*1.5),this.tutorialPhase||this.inCutscene)return}for(this.tutorialPhase&&(this.tutorialPhase=!1,this.nextSpawnY=this.game.camera.y-this.game.canvas.height*1.5);this.nextSpawnY>this.game.camera.y-this.game.canvas.height;)this.spawnObstacleRow(),this.nextSpawnY-=this.game.canvas.height*this.game.config.obstacles.verticalSpacing;this.obstacles.forEach(s=>s.update()),this.obstacles=this.obstacles.filter(s=>{if(s.checkCollision(this.game.spacecraft)){if(this.game.spacecraft.shieldActive)return this.destructionParticles.push(...s.createDestructionParticles()),this.showScorePopup(s.x,s.y,10),this.game.score+=10,!1;this.game.gameOver()}return!0}),this.obstacles=this.obstacles.filter(s=>s.y>this.game.camera.y-this.game.canvas.height*1.5),this.destructionParticles=this.destructionParticles.map(s=>({...s,x:s.x+s.vx*(1/60),y:s.y+s.vy*(1/60),opacity:s.opacity-.02,size:s.size*.98})).filter(s=>s.opacity>0);const e=performance.now();e-this.lastCometTime>this.cometInterval&&(this.spawnComet(),this.lastCometTime=e,this.cometInterval=9e3+Math.random()*14e3)}showTutorialMessage(t){this.game.milestoneManager.showMessage(t)}getDifficultyMultiplier(){const t=this.game.config.obstacles.scaling,e=Math.min(this.game.score/t.rampUpDistance,1);return t.startDensity+(t.maxDensity-t.startDensity)*e}updateAvailableTypes(){const t=this.game.score;Object.entries(this.obstacleTypes).forEach(([e,s])=>{t>=s.unlockScore&&this.availableTypes.add(e)})}spawnObstacleRow(){this.updateAvailableTypes();const t=Array.from(this.availableTypes),e=t.map(h=>this.obstacleTypes[h].weight),s=e.reduce((h,n)=>h+n,0);console.log("Available types:",t),console.log("Weights:",e);const i=Math.random();let a=0;for(let h=0;h<t.length;h++)if(a+=e[h]/s,i<=a){const n=t[h];switch(console.log("Selected type:",n,"Random:",i,"Cumulative:",a),n){case"belt":return this.spawnAsteroidBelt();case"complex":return this.spawnComplexAsteroid();case"pulsating":return this.spawnPulsatingAsteroid();case"moving":return this.spawnMovingAsteroid();case"shooting":return this.spawnShootingAsteroid();case"comet":return this.spawnComet();default:return this.spawnSimpleAsteroids(this.getDifficultyMultiplier())}}return this.spawnSimpleAsteroids(this.getDifficultyMultiplier())}spawnAsteroidBelt(){this.obstacles.push(new z(this.game,this.nextSpawnY))}spawnComplexAsteroid(){const t=this.game.config.obstacles.minSize*this.game.baseUnit+Math.random()*(this.game.config.obstacles.maxSize-this.game.config.obstacles.minSize)*this.game.baseUnit,e=t*3+Math.random()*(this.game.canvas.width-t*6);this.obstacles.push(new T(this.game,e,this.nextSpawnY,t))}spawnSimpleAsteroids(t){const e=Math.min(this.game.score/500,1),i=1+Math.floor(e)+Math.floor(Math.random()*t*e);for(let a=0;a<i;a++){const h=this.game.config.obstacles.minSize*this.game.baseUnit+Math.random()*(this.game.config.obstacles.maxSize-this.game.config.obstacles.minSize)*this.game.baseUnit,n=this.game.canvas.width/i,c=a*n+h,r=(a+1)*n-h;this.obstacles.push(new P(this.game,c+Math.random()*(r-c),this.nextSpawnY,h))}}spawnPulsatingAsteroid(){const t=this.game.config.obstacles.minSize*this.game.baseUnit+Math.random()*(this.game.config.obstacles.maxSize-this.game.config.obstacles.minSize)*this.game.baseUnit,e=t*2+Math.random()*(this.game.canvas.width-t*4);this.obstacles.push(new A(this.game,e,this.nextSpawnY,t))}spawnMovingAsteroid(){const t=this.game.config.obstacles.minSize*this.game.baseUnit+Math.random()*(this.game.config.obstacles.maxSize-this.game.config.obstacles.minSize)*this.game.baseUnit,e=this.game.canvas.width/2;this.obstacles.push(new C(this.game,e,this.nextSpawnY,t))}spawnShootingAsteroid(){const t=this.game.config.obstacles.minSize*this.game.baseUnit+Math.random()*(this.game.config.obstacles.maxSize-this.game.config.obstacles.minSize)*this.game.baseUnit,e=t*2+Math.random()*(this.game.canvas.width-t*4);this.obstacles.push(new I(this.game,e,this.nextSpawnY,t))}spawnComet(){const t=this.game.camera.y-Math.random()*this.game.canvas.height*.5;this.obstacles.push(new Y(this.game,t))}render(t){this.game.camera.shake&&(t.save(),t.translate(this.game.camera.shake.x,this.game.camera.shake.y)),this.obstacles.forEach(e=>e.render(t)),this.inCutscene&&(t.beginPath(),t.strokeStyle="rgba(0, 0, 0, 0.3)",t.lineWidth=2,this.motionLines.forEach(e=>{t.moveTo(e.x,e.y),t.lineTo(e.x,e.y+e.length)}),t.stroke()),this.destructionParticles.forEach(e=>{e.isScorePopup?(t.save(),t.font=`${e.size}px Arial`,t.fillStyle=`rgba(0, 0, 0, ${e.opacity})`,t.textAlign="center",t.fillText(e.text,e.x,this.game.camera.getRelativeY(e.y)),t.restore()):(t.beginPath(),t.arc(e.x,this.game.camera.getRelativeY(e.y),e.size,0,Math.PI*2),t.fillStyle=`rgba(0, 0, 0, ${e.opacity})`,t.fill())}),this.game.camera.shake&&t.restore()}showScorePopup(t,e,s){this.destructionParticles.push({x:t,y:e,vy:-2,vx:0,size:this.game.baseUnit,opacity:1,text:`+${s}`,isScorePopup:!0})}createMotionLines(){for(let e=0;e<20;e++)this.motionLines.push({x:Math.random()*this.game.canvas.width,y:Math.random()*this.game.canvas.height,length:20+Math.random()*30,speed:15+Math.random()*10})}updateMotionLines(){this.motionLines.forEach(t=>{t.y+=t.speed,t.y>this.game.canvas.height&&(t.y=-t.length,t.x=Math.random()*this.game.canvas.width)})}}class O{constructor(t){this.game=t,this.y=0,this.targetY=0,this.totalDistance=0,this.speed=t.config.camera.speed*t.canvas.height,this.interpolation=t.config.camera.interpolation,this.idealOffset=t.canvas.height*.75,this.velocity=0,this.shake={x:0,y:0}}update(t=1){const s=(this.game.spacecraft.y-this.idealOffset-this.y)*this.interpolation*t;this.velocity=this.velocity*this.game.config.camera.smoothingFactor+s*(1-this.game.config.camera.smoothingFactor),this.y+=this.velocity,this.totalDistance=Math.abs(this.y)}getRelativeY(t){return t-this.y}}class D{constructor(t){this.game=t,this.setupKeyboardControls(),this.setupTouchControls(),this.touchStartX=null,this.touchStartY=null,this.minSwipeDistance=30}setupKeyboardControls(){window.addEventListener("keydown",t=>{switch(t.key){case"ArrowLeft":this.game.spacecraft.startMovement("left");break;case"ArrowRight":this.game.spacecraft.startMovement("right");break}})}setupTouchControls(){const t=this.game.canvas;t.addEventListener("touchstart",e=>{e.preventDefault();const s=e.touches[0];this.touchStartX=s.clientX,this.touchStartY=s.clientY}),t.addEventListener("touchmove",e=>{if(e.preventDefault(),!this.touchStartX)return;const i=e.touches[0].clientX-this.touchStartX;Math.abs(i)>this.minSwipeDistance&&(i>0?this.game.spacecraft.startMovement("right"):this.game.spacecraft.startMovement("left"),this.touchStartX=null)}),t.addEventListener("touchend",()=>{this.touchStartX=null,this.touchStartY=null}),t.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1})}}class b{constructor(t){this.game=t,this.milestones=[...t.config.milestones],this.currentMilestone=null,this.messageAlpha=0,this.messageTimer=0}showMessage(t){this.currentMilestone={message:t},this.messageAlpha=0,this.messageTimer=3e3}update(){this.milestones.length>0&&this.game.score>=this.milestones[0].score&&(this.currentMilestone=this.milestones.shift(),this.messageAlpha=0,this.messageTimer=3e3),this.messageTimer>0&&(this.messageTimer-=1e3/60,this.messageTimer>2500?this.messageAlpha=(3e3-this.messageTimer)/500:this.messageTimer<500?this.messageAlpha=this.messageTimer/500:this.messageAlpha=1)}render(t){this.currentMilestone&&this.messageTimer>0&&(t.save(),t.font=`${3*this.game.baseUnit}px Arial`,t.textAlign="center",t.textBaseline="middle",t.shadowColor="rgba(255, 255, 255, 0.8)",t.shadowBlur=1.5*this.game.baseUnit,t.fillStyle=`rgba(255, 255, 255, ${this.messageAlpha})`,t.fillText(this.currentMilestone.message,this.game.canvas.width/2,this.game.canvas.height/2),t.restore())}}class k{constructor(t,e,s){this.game=t,this.x=e,this.y=s,this.size=t.baseUnit*2,this.rotation=0,this.rotationSpeed=.02,this.pulsePhase=0}update(){this.rotation+=this.rotationSpeed,this.pulsePhase+=.05}render(t){const e=this.game.camera.getRelativeY(this.y);if(e+this.size<0||e-this.size>this.game.canvas.height)return;t.save(),t.translate(this.x,e),t.rotate(this.rotation);const s=1+Math.sin(this.pulsePhase)*.2,i=this.size*s;t.beginPath(),t.arc(0,0,i,0,Math.PI*2),t.strokeStyle="#000000",t.lineWidth=this.game.baseUnit*.3,t.stroke();const a=i*.5;t.beginPath(),t.moveTo(-a,0),t.lineTo(a,0),t.moveTo(0,-a),t.lineTo(0,a),t.stroke(),t.restore()}checkCollision(t){const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)<this.size+t.radius}}class R{constructor(t){this.game=t,this.reset()}reset(){this.powerUps=[],this.nextSpawnY=-250,this.minSpawnInterval=600,this.maxSpawnInterval=800,this.lastSpawnDistance=0,this.nextSpawnDistance=this.calculateNextSpawnDistance(),this.powerUpTypes=["shield"],this.game.soundManager||(console.warn("SoundManager not initialized"),this.game.soundManager={playPowerup:()=>{}}),console.log("PowerUpManager reset")}calculateNextSpawnDistance(){return this.minSpawnInterval+Math.random()*(this.maxSpawnInterval-this.minSpawnInterval)}update(){const t=Math.abs(this.game.camera.totalDistance);t%100===0&&(console.log("Current distance:",t),console.log("Next spawn at:",this.lastSpawnDistance+this.nextSpawnDistance)),t>=this.lastSpawnDistance+this.nextSpawnDistance&&(console.log("Spawning shield at distance:",t),this.spawnPowerUp(),this.lastSpawnDistance=t,this.nextSpawnDistance=this.calculateNextSpawnDistance()),this.powerUps.forEach(e=>e.update()),this.powerUps=this.powerUps.filter(e=>{var s,i;return e.checkCollision(this.game.spacecraft)?(console.log("Shield collected!"),(i=(s=this.game.soundManager)==null?void 0:s.playPowerup)==null||i.call(s),this.game.spacecraft.activateShield(),!1):e.y>this.game.camera.y-this.game.canvas.height*1.5})}spawnPowerUp(){const t=this.game.baseUnit*4,e=this.game.canvas.width-t*2,s=t+Math.random()*e,i=this.game.camera.y-this.game.canvas.height;this.powerUps.push(new k(this.game,s,i))}render(t){this.powerUps.forEach(e=>e.render(t))}}class E{constructor(){this.sounds={bgm:new Audio("/sounds/bgm.mp3"),shield:new Audio("/sounds/shield.mp3"),explosion:new Audio("/sounds/explosion.mp3"),powerup:new Audio("/sounds/powerup.mp3"),move:new Audio("/sounds/move.mp3")},this.sounds.bgm.loop=!0,this.sounds.bgm.volume=.2,this.sounds.shield.volume=.3,this.sounds.explosion.volume=.4,this.sounds.powerup.volume=.3,this.sounds.move.volume=.15,this.initialized=!1}initialize(){this.initialized||(Object.values(this.sounds).forEach(t=>{t.play().catch(()=>{}),t.pause(),t.currentTime=0}),this.initialized=!0)}playBGM(){this.sounds.bgm.play().catch(()=>{})}stopBGM(){this.sounds.bgm.pause(),this.sounds.bgm.currentTime=0}playShield(){this.sounds.shield.currentTime=0,this.sounds.shield.play().catch(()=>{})}playExplosion(){this.sounds.explosion.currentTime=0,this.sounds.explosion.play().catch(()=>{})}playPowerup(){this.sounds.powerup.currentTime=0,this.sounds.powerup.play().catch(()=>{})}playMove(){this.sounds.move.playing||(this.sounds.move.currentTime=0,this.sounds.move.play().catch(()=>{}))}}class B{constructor(t){console.log("Game initializing..."),this.config=t,this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.baseUnit=0,this.score=0,this.isGameOver=!1,this.gameOverAlpha=0,this.explosionParticles=[],this.gameOverScreen="main",this.setupCanvas(),this.initializeGame(),window.addEventListener("resize",()=>this.setupCanvas()),this.setupEventListeners(),this.powerUpManager=new R(this),this.soundManager=new E,window.addEventListener("click",()=>{this.soundManager.initialize(),this.soundManager.playBGM()},{once:!0})}setupCanvas(){console.log("Setting up canvas...");const t=this.canvas.parentElement,e=t.clientWidth,s=t.clientHeight;this.canvas.width=e,this.canvas.height=s;const i=window.innerWidth<=768;this.baseUnit=i?Math.min(e/30,s/50):e/50,console.log("Base unit:",this.baseUnit)}initializeGame(){console.log("Initializing game components..."),this.camera=new O(this),this.spacecraft=new M(this),this.obstacleManager=new w(this),this.inputHandler=new D(this),this.milestoneManager=new b(this)}start(){this.gameLoop()}gameLoop(){this.ctx.fillStyle="#E1D9C1",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.update(),this.render(),requestAnimationFrame(()=>this.gameLoop())}update(){const t=performance.now();if(this.isGameOver){const e=t-this.gameOverStartTime,s=this.config.camera.deceleration;if(e<s){const i=1-e/s;this.camera.update(i)}}else this.camera.update(1),this.spacecraft.update(),this.obstacleManager.update(),this.milestoneManager.update(),this.updateScore();this.updateExplosion(),this.powerUpManager.update()}render(){if(this.isGameOver){const t=performance.now()-this.gameOverStartTime,e=this.config.camera.deceleration;if(this.ctx.fillStyle="#E1D9C1",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),t<e){for(const s of this.explosionParticles)this.ctx.fillStyle=`rgba(0, 0, 0, ${s.opacity})`,this.ctx.beginPath(),this.ctx.arc(s.x,this.camera.getRelativeY(s.y),s.size,0,Math.PI*2),this.ctx.fill();if(t>e*.7){const s=(t-e*.7)/(e*.3);this.ctx.fillStyle=`rgba(0, 0, 0, ${s})`,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}else this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.gameOverScreen==="main"?this.renderMainGameOver():this.gameOverScreen==="highscores"&&this.renderHighScores()}else this.ctx.fillStyle="#E1D9C1",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.obstacleManager.render(this.ctx),this.spacecraft.isVisible&&this.spacecraft.render(this.ctx),this.milestoneManager.render(this.ctx),this.ctx.fillStyle="#000000",this.ctx.font=`${this.baseUnit*2}px Arial`,this.ctx.textAlign="left",this.ctx.fillText(`Score: ${Math.floor(this.score)}`,this.baseUnit*2,this.baseUnit*3);this.powerUpManager.render(this.ctx)}renderMainGameOver(){const t=this.canvas.width/2,e=this.baseUnit*4;let s=this.canvas.height*.3;this.ctx.fillStyle="#E1D9C1",this.ctx.font=`bold ${this.baseUnit*4}px Arial`,this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",t,s),s+=e*1.5,this.ctx.font=`${this.baseUnit*2}px Arial`,this.ctx.fillText(`Distance: ${Math.floor(this.finalScore)} units`,t,s),s+=e*1.5;const i=this.baseUnit*12,a=this.baseUnit*3,h=s;this.drawButton(t-i-this.baseUnit,h,i,a,"Play Again","#4CAF50"),this.drawButton(t+this.baseUnit,h,i,a,"High Scores","#2196F3"),this.gameOverButtons={playAgain:{x:t-i-this.baseUnit,y:h,width:i,height:a},highScores:{x:t+this.baseUnit,y:h,width:i,height:a}}}renderHighScores(){const t=this.canvas.width/2;let e=this.canvas.height*.2;this.ctx.fillStyle="#E1D9C1",this.ctx.font=`bold ${this.baseUnit*3}px Arial`,this.ctx.textAlign="center",this.ctx.fillText("HIGH SCORES",t,e),e+=this.baseUnit*4,this.highScores&&this.highScores.length>0?(this.ctx.font=`${this.baseUnit*2}px Arial`,this.highScores.slice(0,5).forEach((h,n)=>{const r=`${n===0?"ðŸ¥‡":n===1?"ðŸ¥ˆ":n===2?"ðŸ¥‰":"  "} ${h.player_name}`,m=`${h.score}`;this.ctx.textAlign="left",this.ctx.fillText(r,t-this.baseUnit*10,e+n*this.baseUnit*3),this.ctx.textAlign="right",this.ctx.fillText(m,t+this.baseUnit*10,e+n*this.baseUnit*3)})):this.ctx.fillText("No scores yet!",t,e);const s=this.baseUnit*10,i=this.baseUnit*3,a=this.canvas.height*.8;this.drawButton(t-s/2,a,s,i,"Back","#FF5722"),this.highScoresBackButton={x:t-s/2,y:a,width:s,height:i}}drawButton(t,e,s,i,a,h){this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.roundRect(t,e,s,i,i/4),this.ctx.fill(),this.ctx.fillStyle="#FFFFFF",this.ctx.font=`bold ${this.baseUnit*1.5}px Arial`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(a,t+s/2,e+i/2)}updateScore(){this.score=Math.floor(Math.abs(this.camera.totalDistance))}async gameOver(){if(!this.isGameOver){if(this.soundManager.stopBGM(),this.soundManager.playExplosion(),this.isGameOver=!0,this.gameOverStartTime=performance.now(),this.finalScore=this.score,this.score>100){const t=localStorage.getItem("playerName")||"Anonymous",e=JSON.parse(localStorage.getItem("highScores")||"[]");e.push({player_name:t,score:this.score}),e.sort((s,i)=>i.score-s.score),localStorage.setItem("highScores",JSON.stringify(e.slice(0,10))),this.highScores=e}this.explosionParticles=this.createExplosionParticles(this.spacecraft.x,this.spacecraft.y),this.spacecraft.isVisible=!1,this.loadHighScores()}}async loadHighScores(){try{this.highScores=JSON.parse(localStorage.getItem("highScores")||"[]")}catch(t){console.error("Failed to load high scores:",t),this.highScores=[]}}createExplosionParticles(t,e){const s=[],i=this.baseUnit*.5;for(let a=0;a<30;a++){const h=Math.PI*2*a/30,n=i*(2+Math.random()*3);s.push({x:t,y:e,vx:Math.cos(h)*n,vy:Math.sin(h)*n,size:this.baseUnit*(.3+Math.random()*.4),opacity:1,rotation:Math.random()*Math.PI*2})}return s}updateExplosion(){const t=performance.now();if(this.isGameOver){const e=t-this.gameOverStartTime,s=this.config.camera.deceleration;e<s?this.explosionParticles=this.explosionParticles.map(i=>{const a=e/s;return{...i,x:i.x+i.vx*(1-a),y:i.y+i.vy*(1-a),size:i.size*(1+a*.5),opacity:1-e/s}}):e>=s&&(this.explosionParticles=[],this.gameOverAlpha=Math.min(1,(e-s)/1e3))}}setupEventListeners(){this.canvas.addEventListener("click",t=>{if(!this.isGameOver||performance.now()-this.gameOverStartTime<this.config.camera.deceleration)return;const s=this.canvas.getBoundingClientRect(),i=t.clientX-s.left,a=t.clientY-s.top;this.gameOverScreen==="main"?this.isClickInButton(i,a,this.gameOverButtons.playAgain)?this.restart():this.isClickInButton(i,a,this.gameOverButtons.highScores)&&(this.gameOverScreen="highscores"):this.gameOverScreen==="highscores"&&this.isClickInButton(i,a,this.highScoresBackButton)&&(this.gameOverScreen="main")})}isClickInButton(t,e,s){return t>=s.x&&t<=s.x+s.width&&e>=s.y&&e<=s.y+s.height}restart(){this.gameOverScreen="main",this.soundManager.playBGM(),this.isGameOver=!1,this.gameOverAlpha=0,this.explosionParticles=[],this.score=0,this.camera.y=0,this.camera.targetY=0,this.camera.totalDistance=0,this.spacecraft?this.spacecraft.reset():this.spacecraft=new M(this),this.obstacleManager=new w(this),this.milestoneManager=new b(this),this.powerUpManager.reset()}}const L={spacecraft:{radius:1,speed:.08,arcRadius:.2,arcDuration:800,boostSpeed:.03,trailDotSize:.2,trailSpacing:10},camera:{speed:.08,interpolation:.15,deceleration:2e3,smoothingFactor:.92},obstacles:{minSize:2.5,maxSize:6.25,verticalSpacing:.35,rotationRange:[-.02,.02],types:{simple:{unlockScore:0,weight:1},complex:{unlockScore:2e3,weight:.7},belt:{unlockScore:5e3,weight:.4},pulsating:{unlockScore:3e3,weight:.6},moving:{unlockScore:4e3,weight:.5},shooting:{unlockScore:7e3,weight:.3}},scaling:{startDensity:.7,maxDensity:1.5,rampUpDistance:1e4}},milestones:[{score:1e3,message:"Breaking atmosphere..."},{score:2e3,message:"Warning: Complex asteroids detected..."},{score:5e3,message:"Caution: Asteroid belts ahead..."},{score:1e4,message:"Deep space detected..."},{score:25e3,message:"Unknown signals ahead..."},{score:5e4,message:"Approaching the void..."}]};window.addEventListener("load",()=>{let o=localStorage.getItem("playerName");o||(o=prompt("Enter your name:","Anonymous"),o&&localStorage.setItem("playerName",o)),new B(L).start()});
